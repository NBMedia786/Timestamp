<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard ‚Äî Video Analysis</title>
  <link rel="stylesheet" href="/style.css" />
  <style>
    .action-col { width: 50px; text-align: center; }
    
    .action-menu-btn {
      background: none;
      border: 1px solid var(--border);
      color: var(--muted);
      cursor: pointer;
      padding: 6px 8px;
      border-radius: 6px;
      font-size: 16px;
      line-height: 1;
      opacity: 0.7;
      transition: all 0.2s ease;
    }
    .action-menu-btn:hover {
      opacity: 1;
      color: var(--text);
      background: var(--panel);
      border-color: var(--brand);
    }
    .admin-table-menu {
      position: relative;
    }
    .admin-menu-dropdown {
      position: absolute;
      right: 0;
      top: calc(100% + 4px);
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 8px;
      box-shadow: var(--shadow);
      backdrop-filter: var(--glass-blur);
      padding: 4px;
      min-width: 140px;
      z-index: 100;
      animation: menuFadeIn 0.2s ease;
    }
    @keyframes menuFadeIn {
      from { opacity: 0; transform: translateY(-4px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .admin-menu-dropdown.hidden { display: none; }
    .admin-menu-item {
      width: 100%; background: none; border: none; color: var(--text);
      padding: 8px 12px; text-align: left; cursor: pointer; border-radius: 6px;
      display: flex; align-items: center; gap: 10px; font-size: 13px;
      transition: background 0.2s ease, color 0.2s ease;
    }
    .admin-menu-item:hover { background: rgba(124, 196, 255, 0.1); }
    .admin-menu-item.delete { color: var(--err); }
    .admin-menu-item.delete:hover { background: rgba(255, 93, 102, 0.1); }
    
    /* --- ADD THIS NEW CSS --- */
    .admin-menu-dropdown.opens-up {
      top: auto;
      bottom: calc(100% + 4px);
      /* Add a little animation for the new direction */
      animation: menuFadeInUp 0.2s ease;
    }

    @keyframes menuFadeInUp {
      from {
        opacity: 0;
        transform: translateY(4px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
  <div class="container admin-container">
    <header class="header admin-header">
      <div class="title-wrap">
        <h1>Admin Dashboard</h1>
        <p class="subtitle muted">Application Statistics & Logs</p>
      </div>
      <div class="header-actions">
        <button id="refresh-btn" class="btn ghost admin-refresh-btn" aria-label="Refresh Dashboard">
          <span class="refresh-icon">üîÑ</span>
          <span class="refresh-text">Refresh</span>
        </button>
        <a class="btn ghost" href="/">‚Üê Back to App</a>
      </div>
    </header>

    <section class="panel glass admin-panel">
      <div class="panel-header">
        <h2>Overview</h2>
      </div>
      <div class="stat-grid" id="stat-grid">
        <div class="stat-card">
          <div class="stat-title">Total Users</div>
          <div id="stat-total-users" class="stat-value">...</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">Total Logins</div>
          <div id="stat-total-logins" class="stat-value">...</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">Completed Jobs</div>
          <div id="stat-completed-jobs" class="stat-value stat-value-ok">...</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">Failed Jobs</div>
          <div id="stat-failed-jobs" class="stat-value stat-value-err">...</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">Processing Jobs</div>
          <div id="stat-processing-jobs" class="stat-value stat-value-warn">...</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">Avg. Analysis Time</div>
          <div id="stat-avg-time" class="stat-value">...</div>
        </div>

        <div class="stat-card">
          <div class="stat-title">Total Analysis Time</div>
          <div id="stat-total-time" class="stat-value">...</div>
        </div>
      </div>
    </section>

    <section class="panel glass admin-panel">
      <div class="panel-header">
        <h2>Recent Analysis Jobs</h2>
      </div>
      <div class="table-container" id="jobs-table-container">
        <table class="table admin-table" id="jobs-table">
          <thead>
            <tr>
              <th>User</th>
              <th>Job Name</th>
              <th>Status</th>
              <th>Time</th>
              <th>Error</th>
              <th class="action-col">Actions</th>
            </tr>
          </thead>
          <tbody id="table-recent-jobs"></tbody>
        </table>
        <div id="jobs-pagination" class="pagination-controls" style="display: flex; justify-content: space-between; align-items: center; margin-top: 16px; padding: 12px;">
          <button id="jobs-prev-btn" class="btn ghost" style="display: none;">‚Üê Previous</button>
          <span id="jobs-pagination-info" class="muted" style="font-size: 14px;"></span>
          <button id="jobs-next-btn" class="btn ghost" style="display: none;">Next ‚Üí</button>
        </div>
      </div>
    </section>

    <section class="panel glass admin-panel">
      <div class="panel-header">
        <h2>Recent Logins</h2>
      </div>
      <div class="table-container" id="logins-table-container">
        <table class="table admin-table" id="logins-table">
          <thead>
            <tr>
              <th>User</th>
              <th>Email</th>
              <th>Time</th>
            </tr>
          </thead>
          <tbody id="table-recent-logins"></tbody>
        </table>
      </div>
    </section>
  </div>

  <div id="historyModal" class="progress-modal hidden" style="z-index: 1001;">
    <div class="progress-modal-content glass" style="width: 500px; max-height: 600px; gap: 10px; align-items: stretch;">
      <button id="closeHistoryModal" class="progress-modal-close" aria-label="Close" title="Close">√ó</button>
      <h3 id="historyModalTitle" class="progress-status-text" style="text-align: left; font-size: 20px;">Login History</h3>
      <p id="historyModalUser" class="subtitle muted" style="text-align: left; margin: -10px 0 10px; font-size: 14px;"></p>
      <div class="table-container" style="max-height: 400px; overflow-y: auto;">
        <table class="table">
          <thead><tr><th>Date & Time</th></tr></thead>
          <tbody id="historyModalTableBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script src="/admin.js" type="module"></script>
</body>
</html>
